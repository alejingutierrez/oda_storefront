# STATUS (resumen operativo)

Usar este archivo para registrar, de forma breve, el estado global y los cierres de historias.

Formato sugerido:
- YYYY-MM-DD | MC-XXX | done | Resumen corto de lo entregado | Notas (build Vercel ok?/link, README actualizado, etc.)

Checklist obligatorio al cerrar una historia:
0) Pedir requisitos previos al solicitante (credenciales/API keys, definiciones faltantes, accesos).
1) Levantar servicios locales necesarios (web/scraper/worker) y revisar logs.
2) Push a la rama.
3) Esperar y revisar build en Vercel hasta que finalice correctamente.
4) Actualizar README con cambios relevantes.
5) Marcar la historia como terminada en `USER_STORIES.md`, `BACKLOG.md` y en este `STATUS.md`.

Registros:
- 2026-02-15 | MC-127 | done | Admin `/admin/product-curation`: filtro por SEO tags (facet top 100 + query param `seo_tag`) para acelerar curación | Validación local: `npx eslint <archivos tocados>` + `npx tsc --noEmit --project tsconfig.json` (en `apps/web`) OK. Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-dt6g7ygud-alejingutierrezs-projects.vercel.app, id `dpl_C8rztX4CWzUSm3WbZVttbUJv4kxd`, commit `6eb7b68`). Runtime logs: 200 en `/api/admin/catalog-extractor/drain`.
- 2026-02-15 | MC-125 | fix | PLP `/catalogo` (mobile): fix overflow por rail horizontal de subcategorías + columnas al nivel del título + remover toggle de formato (siempre 3:4) + ToTop sin cruce con barra de subcategorías; además se elimina hydration mismatch en header (React #418) | Validación local: `npx eslint src/components/AccountLink.tsx` + `npx tsc --noEmit --project tsconfig.json` (en `apps/web`) OK. Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-m43b9ibg8-alejingutierrezs-projects.vercel.app, id `dpl_6fYhyS5rRPxS6nAsbXwwyRWXRSsA`, commits `77fd5d7` + `eb46985`). Smoke Playwright: viewport 390px, overflow=0 y ToTop no interseca Subcategorías.
- 2026-02-15 | MC-016 | done | PLP `/catalogo`: filtros <2s (p95 <0.40s en endpoints clave, Over2s=[]) + hardening UI de subcategorías | DB (Neon): índices concurrentes para acelerar queries de catálogo (`products(category, createdAt)`, `products(category, subcategory, createdAt)` con enrichment+cover, `variants(productId)` instock y `variants(price)` instock+price). Scripts: `apps/web/scripts/catalog-filter-indexes.sql` + `apps/web/scripts/apply-catalog-filter-indexes.sh`. Bench reproducible: `apps/web/scripts/benchmark-catalog-filters.mjs` (y `apps/web/scripts/benchmark-catalog-filters.sh`). UI: “No hay subcategorías…” ahora espera 500ms antes de mostrarse (evita falso negativo transitorio). Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-hq6prrfu8-alejingutierrezs-projects.vercel.app, id `dpl_ENhnTCmoJ24xVBkrgbgqP3uHNbHX`, commit `0d9927b`). Smoke: `/api/catalog/products-page`, `/api/catalog/subcategories`, `/api/catalog/price-bounds`, `/api/catalog/products-count` => 200.
- 2026-02-15 | MC-114 | fix | Auth usuarios (Descope): `/api/user/*` valida sesión con `Authorization: Bearer <sessionToken>` en cada handler (Descope `validateSession`), sin depender de cookie `DS`; middleware ya no protege `/api/user` ni `/perfil`; callback `/auth/callback` reintenta hasta tener token y sincroniza el usuario | Validación local: eslint (archivos tocados) + `tsc --noEmit` OK. Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-ohswsulv3-alejingutierrezs-projects.vercel.app, id `dpl_v5i43EbVu53F7moJDyVuuj7GA1qR`, commit `01c5830`). Smoke: `POST /api/user/sync` => 401 sin token, 200 con token válido.
- 2026-02-15 | MC-114 | fix | Auth usuarios (Descope): login social más confiable al iniciar OAuth desde `/sign-in` (evita popups bloqueados) usando `redirectUrl=<origin>/sign-in` en el componente Descope | Validación local: `eslint` + `tsc --noEmit` OK. Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-msxjiwwkn-alejingutierrezs-projects.vercel.app, id `dpl_Cj7RzPKEsHZHRsWTAv35rJVJpJFW`, commit `f18d5d2`). Smoke: Playwright click en “Continua con Google” navega a `accounts.google.com`.
- 2026-02-15 | MC-114 | fix | Auth usuarios (Descope): hardening del retorno OAuth en `/sign-in`: intercepta `?code=`/`?err=`, ejecuta `sdk.oauth.exchange(code)` explícito (1 sola vez) y ofrece “Reintentar” limpiando la URL; mensaje específico para `E061301` (código expirado/usado) y `E062209` (setup OAuth) | Validación local: `npx eslint src/app/sign-in/SignInClient.tsx` + `npx tsc --noEmit` OK. Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-e03rdveq8-alejingutierrezs-projects.vercel.app, id `dpl_GC6U8rxzff385ZPhkNwEHvscsTKW`, commit `e6e96d9`). Smoke: Playwright `/sign-in?code=foo` muestra “Reintentar”, `/sign-in?err=E062209` muestra error de setup y permite reintentar.
- 2026-02-15 | MC-126 | done | PLP `/catalogo`: polish desktop + listas + SEO + header | Desktop: card “Filtros” iguala altura con toolbar, columna filtros +20px, scroll por zonas (wheel izquierda => filtros), categorías top 10 con “Ver más/menos”, toast 6s “Agregar a una lista” al dar fav + drawer de listas (crear+guardar), e indicador fijo “% visto” sobre botón Arriba. SEO: `generateMetadata` + canonical y `noindex` defensivo en filtros profundos; `/buscar` canonical a `/catalogo`. Header: avatar sin texto, “Ingresar” consistente, hover mejorado y glass en menús. Validación local: `npx eslint <archivos tocados>` + `npx tsc --noEmit` OK. Build local: no verificable en sandbox por DB (prerender `/` falla con `ECONNREFUSED`).
- 2026-02-14 | MC-114 | fix | Auth usuarios (Descope): login deja de rebotar a `/sign-in` por cookie de session no creado; ahora session token persiste en storage y refresh token va en cookie (para que `/perfil` pase middleware). Callback `/auth/callback` y llamadas a `/api/user/*` leen token robustamente (evita 401 falsos por race) | Validacion local: `eslint` + `tsc --noEmit` OK. Deploy: pendiente.
- 2026-02-14 | MC-125 | fix | PLP `/catalogo`: hardening al volver a pestaña (cache facets/subcats/precio), precio robusto (p02/p98 + histograma/presets), layout mobile (1:1/3:4 + ToTop arriba), header sin reacción al scroll + menú mobile con scroll interno, sin cesta en cards, toolbar icon-only, enlaces de producto en nueva pestaña | Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-980uh4xip-alejingutierrezs-projects.vercel.app, id `dpl_HtZpGVMPoqjqLprpEU7D4s19N99g`, commit `232787b`). Smoke: `GET /catalogo` 200, `GET /api/catalog/products?page=1` 200, `GET /api/catalog/price-bounds` 200.
- 2026-02-14 | MC-124 | fix | Taxonomy remap: hardening plural/singular (cacheteros→ropa interior, montura→monturas) + nuevas regressions | Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-nxw9yb8j4-alejingutierrezs-projects.vercel.app, commit `16467fc`). Auditoría pending sample (200): suspiciousDenim=1 (solo flag de inspección).
- 2026-02-14 | MC-124 | fix | Taxonomy remap: fixes específicos (sets→tops churn, charms→collares por “cadena”, monturas→gafas de sol por empate en “gafas”, aretes con “botas/tenis”→calzado, “culotte” underwear→pantalón) | `refresh_pending` aplicado; verificación con casos reales (Paradizia/Citybags/Scalpers/Brezo/Laura) y auditoría pending sample (200): suspicious=0.
- 2026-02-14 | MC-124 | fix | Taxonomy remap: hardening contra falsos positivos (ropa interior→lencería, panty→medias lencería, ear cuff→piercings, short de baño→short casual algodón, canguro/riñonera→hoodie) con nuevas señales y gating en `signal-harvester` + `auto-reseed` | Auditoría pending sample (200) post-refresh: nuevos suspicious=0; build local OK con Neon `DATABASE_URL`.
- 2026-02-14 | MC-124 | fix | Taxonomy remap: reducir falsos positivos (subcategorías por anclas genéricas), endurecer evidencia para cambios de subcategoría, evitar churn de sportswear→tops, y permitir `refresh_pending` sin cooldown | Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-4ifpme476-alejingutierrezs-projects.vercel.app, commit `7b2bf7f`). Auditoría pending sample (200): suspicious=0.
- 2026-02-14 | MC-125 | done | Catálogo público: refinamientos PLP `/catalogo` (mobile + precio + cards) | Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-nl5lwk1zl-alejingutierrezs-projects.vercel.app, id `dpl_DnVY2fEwkVTC4tyXrXm5UQjAotwt`, commit `a83394e`). Smoke: `GET /catalogo` 200, `GET /api/catalog/products?page=1` 200.
- 2026-02-13 | MC-124 | fix | Auto-reseed sin aprendizaje histórico + batch manual 10K estable | Se removió la fase de aprendizaje (`accepted/rejected`) del motor `auto-reseed` y ahora las propuestas se calculan con señales directas del producto enriquecido (nombre/descripcion original/metadata/SEO). Se optimizó persistencia de propuestas por chunk con `deleteMany + createMany` (en vez de inserts fila a fila), se elevó `maxDuration` a `300` en rutas de auto-reseed y accept/reject, y el front dejó de mostrar métricas de aprendizaje. El botón manual conserva `limit=10000`; ejecuciones no manuales usan límite conservador (2000) para evitar bloqueos, y `force` ahora puede recuperar corridas largas atascadas (`TAXONOMY_REMAP_AUTO_RESEED_FORCE_RECOVER_MINUTES`).
- 2026-02-13 | MC-124 | fix | Auto-reseed/remap hardening: aprendizaje más limpio + feedback visual de ejecución en `/admin/taxonomy-remap-review` | `auto-reseed` ahora aprende solo de decisiones con cambio real por campo (cat/subcat/género), excluye productos ya revisados para evitar repropuestas repetidas y registra corridas en tabla `taxonomy_remap_auto_reseed_runs` con lock persistente (índice único parcial `status='running'`). La UI muestra estado `en ejecución`, run activo y último resultado de evaluación (scanned/proposed/enqueued + muestras de aprendizaje). Migración SQL aplicada en Neon (`20260213150000_taxonomy_remap_auto_reseed_runs`) y tabla verificada.
- 2026-02-13 | MC-124 | fix | Remap heurísticas: suprimir `infantil` por color "bebé/baby", reforzar `llavero→dijes_charms` y "cuidado de cuero→hogar_otros", y permitir recalcular solo pendientes (`mode=refresh_pending`) | Deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-jf951p8d5-alejingutierrezs-projects.vercel.app, id `dpl_6bK9jrv4GBabj3haZTjGLgVFWqCV`). Auto-reseed manual `refresh_pending` ejecutado: runKey `20260213_221436` (scanned 3376, proposed 3183).
- 2026-02-12 | MC-124 | fix | Remapper reglas: `llavero/keychain` → `joyeria_y_bisuteria/dijes_charms`, `cardholder/wallet` → `bolsos_y_marroquineria/billetera`, care de cuero (grasa/betún/limpiador para cuero) → `hogar_y_lifestyle/hogar_otros`, y override “Camisa” sobre buckets `blusa_*` (cuando el nombre lo indica) | Se evitó doble conteo SEO (tag canónico + lexical) cuando el canónico ya existe para mejorar overrides de misclasificados anclados. Dry-run OK con 6 casos target y muestreo random 5k. Commit `db236ed`.
- 2026-02-12 | MC-124 | fix | Remap review: UX más rápida (optimistic UI). Al aceptar/rechazar, la fila sale inmediatamente y se hace refresh silencioso con debounce para evitar el parpadeo de “Cargando revisiones...” en cada decisión | Push `494e1e3`; Vercel deploy pendiente.
- 2026-02-12 | MC-124 | fix | UX de revisión remap sin fricción: acciones `Aceptar/Rechazar` ahora son inmediatas (sin prompt de motivo ni confirmaciones), y se añadió contador global de catálogo + contador de elegibles enriquecidos/faltantes en `/admin/taxonomy-remap-review` | API `GET /api/admin/taxonomy-remap/reviews` expone `catalog.totalProducts/reviewed/pending/remaining` y `catalog.eligible*`; validación local eslint + tsc OK. Push `3a55b5a`; deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-r3txk0p61-alejingutierrezs-projects.vercel.app, id `dpl_7zWToERuYYXccYqHLQLuugExCKAa`). Verificación runtime por curl: endpoint reviews 200 con nuevos campos de conteo.
- 2026-02-12 | MC-124 | done | Taxonomy remap: aprendizaje continuo + auto-reseed por umbral + contador de faltantes de fase | Se implementó motor `auto-reseed` (`src/lib/taxonomy-remap/auto-reseed.ts`) que aprende de decisiones manuales (`accepted/rejected`) usando nombre/descripcion/descripcion original/SEO y propone remapeos para productos enriquecidos. Nuevo trigger automático cuando `pending <= 100` (configurable) con cooldown, endpoints `GET/POST /api/admin/taxonomy-remap/auto-reseed` y cron `GET/POST /api/admin/taxonomy-remap/auto-reseed/cron` (programado en `apps/web/vercel.json`). `GET /api/admin/taxonomy-remap/reviews` ahora retorna `phase` (faltantes, umbral, último auto-reseed), y el panel `/admin/taxonomy-remap-review` muestra contador y controles de ejecución. Validación local: eslint + `tsc --noEmit` OK. Pushes `60ae1d4` y fix `4b7d278`; deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment final: https://oda-storefront-6ee5-6tyuocfu7-alejingutierrezs-projects.vercel.app, id `dpl_EajfEQHp4LGXbKJvaseeJYRnHXgq`). Verificación runtime: `GET /api/admin/taxonomy-remap/reviews` 200 con `phase`, `POST /api/admin/taxonomy-remap/auto-reseed` 200 (`pending_above_threshold` cuando aplica), logs sin errores.
- 2026-02-12 | MC-123 | done | Cola y panel de revisión manual para remapeo taxonómico (`/admin/taxonomy-remap-review`) con decisiones aceptar/rechazar y aplicación controlada en `products` | Se agregó tabla `taxonomy_remap_reviews` (migración `20260212025000_taxonomy_remap_reviews`), endpoints admin para listar/encolar/aceptar/rechazar propuestas, enlace en navegación admin y soporte en script `remap-noncanonical-taxonomy` para encolar propuestas sin auto-aplicar (SEO-only queda manual). Validación local: `eslint` (archivos tocados en `apps/web`), `tsc --noEmit` y `prisma validate` OK. Pushes `b74b1ee` + `54e56f9`; deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment final: https://oda-storefront-6ee5-1ofpj0yg8-alejingutierrezs-projects.vercel.app, id `dpl_RBgjsMyhpkTKMJD9c3twzV3VMGLH`). Runtime verificado con `GET /api/admin/taxonomy-remap/reviews` 200 y logs de ejecución sin errores.
- 2026-02-12 | MC-122 | done | Clasificador manual de categorías/subcategorías reforzado para enrichment (`signal-harvester`) | Se amplió `keyword-dictionaries.ts` con diccionarios por categoría + reglas de subcategoría para toda la taxonomía publicada, expansión de sinónimos ES/EN por frases/tokens y scoring por coincidencias (`scoreKeywordHits`) para que la inferencia no dependa del primer match. Se mantuvieron desambiguaciones críticas (`collar`, `bota`, `body`). Validación local: `npx eslint src/lib/product-enrichment/keyword-dictionaries.ts src/lib/product-enrichment/signal-harvester.ts` + `npx tsc --noEmit --project tsconfig.json` en `apps/web`. Push `8f2ab5f`; deploy prod Ready: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-4slzhwwvg-alejingutierrezs-projects.vercel.app, id `dpl_JAtDuMzAXJZYeW7ykXnv4HVK49f3`). Runtime logs verificados con 200 en `/api/admin/product-enrichment/state` y `/api/admin/product-enrichment/review-items`.
- 2026-02-11 | MC-121 | fix | Bedrock enrichment: fallback determinístico de subcategoría cuando el modelo devuelve valor fuera de taxonomía (`Subcategory <x> does not belong to <category>`) | Se ajustó `normalizeEnrichment` para intentar matching cercano dentro de subcategorías permitidas por categoría y fallback seguro al primer valor permitido si persiste ambigüedad. Commit `578f0d0`; deploy prod Ready: https://oda-storefront-6ee5.vercel.app (build URL: https://oda-storefront-6ee5-mov1r5vhi-alejingutierrezs-projects.vercel.app, id `dpl_GSeVSkMFXgYnQnFXXxSAcNGEaom5`). Verificación `curl`: `POST /api/admin/product-enrichment/process-item` volvió a `status=completed` en corrida Bedrock (`runId=8b388472-90a7-4d1f-a65c-811b98c61a76`).
- 2026-02-11 | MC-121 | done | Product-enrichment con switch real OpenAI/Bedrock: Bedrock Haiku 4.5 activo para enrichment (`Converse` + tool-use), panel admin con visibilidad de proveedor/modelo y lote solicitado vs creado | Lint focalizado + `npx tsc --noEmit` + build local OK (`npm run build` con `DATABASE_URL`), smoke Bedrock OK (`npx tsx --tsconfig apps/web/tsconfig.json apps/web/scripts/test-bedrock-enrichment.ts` con `bedrock.test.success`). Push `b9f8163`. Deploy prod Ready/alias: https://oda-storefront-6ee5.vercel.app (deployment: https://oda-storefront-6ee5-j0dyqb93x-alejingutierrezs-projects.vercel.app, id `dpl_8548Z3eJGzFg7GqdTQJqJaJzsiMW`). Runtime logs verificados con `vercel logs` (200s en `/api/admin/product-enrichment/state` y `/review-items`). Curl post-deploy: `POST /api/admin/product-enrichment/run` devuelve `requestedItems/selectedItems`; `GET /api/admin/product-enrichment/state` muestra `provider=bedrock` y modelo Haiku 4.5; `POST /api/admin/product-enrichment/process-item` completó correctamente con Bedrock.
- 2026-02-11 | MC-120 | done | Catalog-refresh hardening: evitar auto-ejecución de enrichment `new_products` | Se agregó guardia en `/api/admin/product-enrichment/drain` para pausar corridas `created_by=catalog_refresh` con `auto_start=false` (blockReason `auto_start_disabled`) y normalización adicional en `runCatalogRefreshBatch` para corridas heredadas en `processing`. Al reanudar manualmente con `POST /api/admin/product-enrichment/run` (`resume=true`), la metadata ahora marca `auto_start=true` + `manual_resume_at`. Lint + TypeScript OK. Push `fee803d`. Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_7SsXZPwT2ouv5f6mfRq17sNzPJhb`, URL de build: https://oda-storefront-6ee5-kj31ywbf1-alejingutierrezs-projects.vercel.app). Verificación DB/curl: antes `processing catalog_refresh auto_start=false = 84`; tras invocar cron (`/api/admin/catalog-refresh/cron?maxBrands=1&maxRuntimeMs=5000`) quedó en `0`.
- 2026-02-11 | MC-119 | done | Product-enrichment: `Ejecutar batch/all` ahora crea run nuevo (fresh) y la reanudación es explícita (`Reanudar corrida actual`); API `POST /api/admin/product-enrichment/run` asume `startFresh=true` por defecto cuando `resume=false` y no se envía flag (compatibilidad clientes legacy) | Lint y TypeScript OK. Push `db4d315`. Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_3JD78o4Vwch41YH5tmc6cuCKTgqZ`, URL de build: https://oda-storefront-6ee5-waoac895z-alejingutierrezs-projects.vercel.app). Verificación curl en prod (marca `4724e517-2a5f-4729-a877-dae83d054af1`): `batch=10` => `total=10`; `all` => `total=229`; `pause` + `resume=true` mantiene mismo `runId` (`054a78f6-47d0-475d-ba0b-0a449a8cb082`).
- 2026-02-11 | MC-118 | done | Product-enrichment hardening: normalización defensiva de URLs de imagen antes de OpenAI (`//` y relativas), descarte de URLs inválidas y nuevo endpoint `GET /api/admin/product-enrichment/review-items`; UI `/admin/product-enrichment` mejorada con tabla de revisión manual + baja confianza con razones y accesos directos | Lint y TypeScript OK. Verificación curl en producción: antes del fix `process-item` devolvía `400 Invalid image_url` para item `0f7e43c7-2537-4d11-8312-192ea26714d8`; tras deploy `2d23a7f` en Vercel (`https://oda-storefront-6ee5-93fjovdmk-alejingutierrezs-projects.vercel.app`, `dpl_7vAeBzFt2Tch31DBNvE82L8zkFLn`) el mismo `process-item` devuelve `{\"status\":\"completed\"}` y `state` queda con `lastError=null`.
- 2026-02-11 | MC-110 | fix | `/api/admin/catalog-refresh/cron` corrige parseo de query params opcionales: ya no convierte `null` a `0` (antes degradaba automáticamente a `maxBrands=1`, `brandConcurrency=1`, `maxRuntimeMs=5000`), por lo que el cron sin params vuelve a respetar `CATALOG_REFRESH_*` de entorno | Build local OK con `DATABASE_URL` de prod env; validación manual en prod del endpoint sin params: `processed=16`, `selected=16`, `brandConcurrency=6`; cron automático observado en ticks de 5 minutos.
- 2026-02-11 | MC-110 | ops | Perfil agresivo de `catalog-refresh` en prod: cron cada 5 min (`apps/web/vercel.json`), endpoint cron con `maxDuration=60`, y envs de producción ajustados (`CATALOG_REFRESH_INTERVAL_DAYS=1`, `CATALOG_REFRESH_JITTER_HOURS=2`, `CATALOG_REFRESH_MAX_BRANDS=16`, `CATALOG_REFRESH_BRAND_CONCURRENCY=6`, `CATALOG_REFRESH_MAX_RUNTIME_MS=55000`, `CATALOG_REFRESH_MIN_GAP_HOURS=1`, `CATALOG_REFRESH_COVERAGE_ENABLED=false`) | Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_64r91Wwbikv4xw3nY5XA2vkEgeW9`).
- 2026-02-11 | MC-117 | done | Reingeniería product-enrichment `v12.5`: señales pre-LLM (nombre/descripcion original/vendor metadata), routing determinístico a prompts por grupo, estrategia de imágenes por categoría, validador de consistencia con auto-fix, `confidence` local + `review_required`, preservación de `original_description` y bloqueo por defecto de re-enrichment IA para productos ya enriquecidos | Lint OK (`npm run lint -- <archivos tocados>`), TypeScript OK (`npx tsc --noEmit`); build local falla al final por `Missing DATABASE_URL` en page-data collection. Push OK (`ac0ddfd`); Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_AZuFm3CuSwsyTVnZX4suPogdT6G5`, runtime logs sin errores en ventana de revisión). README/BACKLOG/USER_STORIES actualizados.
- 2026-02-11 | MC-110 | fix | Refresh de catálogo más rápido: procesamiento concurrente de marcas (`CATALOG_REFRESH_BRAND_CONCURRENCY`), opción de desactivar cobertura pesada (`CATALOG_REFRESH_COVERAGE_ENABLED`) y overrides runtime en `/api/admin/catalog-refresh/cron` (`maxBrands`, `brandConcurrency`, `maxRuntimeMs`) | Build local OK; push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_2u3Nr5jie5zfP6L2qc8xmmTPc2MK`, commit `f2d81c0`).
- 2026-02-09 | ux | Curación humana: rediseño modal bulk edit (más simple) con scope “Filtro actual” vs “Selección”, y botón en header para bulk sin selección manual | Push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_8cVsfoD8T4pX5vA3k2yWvZWPsv3E`, commit `b2fad36`).
- 2026-02-09 | MC-115 | fix | Curación humana: la modal de bulk edit ahora acota subcategorías por contexto (filtro/selección/cambio en modal) + endpoint `selection-summary` y preflight para evitar reemplazos inválidos cuando la selección mezcla categorías | Push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_2pf7tDUMrYctkiXDB95CkY9wawkv`, commit `c497578`).
- 2026-02-08 | MC-110 | fix | Catalog refresh hardening: normalización LLM con fallback (evita 429 quota como falla terminal), fallback de imágenes (variant-only), métricas de éxito/fallos por run, umbral para no marcar marca como failed por pocos fallos, y productos nuevos se encolan para enrichment en `paused` (sin auto-ejecución) + script `diagnose-catalog-refresh` | Push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_FqQXo5rMDKYx1mpXeAwNvyaf8nLp`, commit `7bf3103`).
- 2026-02-08 | MC-116 | done | `/catalogo` oculta productos sin `metadata.enrichment` y evita 400 en imágenes cuando el `src` pasa por `/api/image-proxy` (next/image `unoptimized`) + backfill de covers remotos a Blob | Push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_FQMyRdxehn3xTPzeWSbwyyenGETP`, commit `9907f49`). Backfill covers enriched no-Blob: 9098 → 1 (imagen demasiado grande para cachear).
- 2026-02-07 | ux | `/catalogo` rework: “Ordenar” como select único; filtros sticky con scroll interno; infinite scroll (lazy load) en lugar de paginación; marcas sin límite + buscador; opciones con count=0 deshabilitadas y seleccionados arriba; colores estandarizados (chips por gama, sin hex); price range slider dinámico; catálogo solo en stock; imágenes optimizadas vía `/api/image-proxy` + placeholders | Push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_5JyFSGVzJB62JHVC6wbGvPApqbvK`, commit `7fe1ee2`).
- 2026-02-06 | fix | Perfil rediseñado: `/perfil` comparte `Header`/mega menu; favoritos funcional (listar/quitar); listas funcionales (CRUD + items + “Guardar en lista”); botón "Guardar" en cards de `/catalogo`; rutas `/g/*` y `/buscar` existen (evita 404 de prefetch) | Push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_5b1CPf2F3wpPUFGd2BW6qZWEvRuR`, commit `2615a9f`).
- 2026-02-06 | fix | Auth externo: callback robusto (no loops por 401 temprana), `/auth/callback` envia `Authorization: Bearer <sessionToken>` a `/api/user/sync` y las UIs (`/perfil`, favoritos) envian Bearer a `/api/user/*` | Push OK; Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy `dpl_5b1CPf2F3wpPUFGd2BW6qZWEvRuR`, commit `2615a9f`).
- 2026-02-06 | MC-009 | fix | Guardrails al publicar taxonomía: evita romper dependencias (append-only de keys; categorías requeridas activas; cada categoría activa debe tener >=1 subcategoría activa; bloquea publish si faltan style_tags activos; valida consistencia de subcategorías duplicadas) | Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy dpl_CuxvQDboD9P8SYAu9Y4bsKeTEiY9). Smoke: `GET /api/admin/taxonomy/options` 200.
- 2026-02-06 | MC-009 | done | Taxonomía editable (draft→publish) + editor admin `/admin/taxonomy` + endpoints (`/api/admin/taxonomy*`) + editor de `style_profiles` y backfill; consumo dinámico en enrichment, facets y curación humana | Vercel prod Ready: https://oda-storefront-6ee5.vercel.app (deploy dpl_BZDswfP2K8UHbaeHtR2M4s9Qqy9a). Smoke: `GET /api/admin/taxonomy?stage=draft` 200; `GET /api/admin/product-curation/products` 200.
- 2026-02-05 | MC-115 | fix | Bulk edit ahora permite múltiples cambios en la misma modal (varios campos a la vez) y el endpoint `/api/admin/product-curation/bulk` acepta `changes[]` en una sola transacción por producto | Vercel prod Ready: https://oda-storefront-6ee5-ibrrdyb0u-alejingutierrezs-projects.vercel.app
- 2026-02-05 | MC-115 | done | Curación humana: `/admin/product-curation` con scroll infinito + selección multi-producto + bulk edit de características (replace/add/remove/clear) con auditoría `metadata.enrichment_human` sin tocar enrichment IA ni SEO/description | Build local OK; push OK; Vercel prod Ready: https://oda-storefront-6ee5-ekyemts65-alejingutierrezs-projects.vercel.app
- 2026-02-05 | fix | Auth externo: callback server-side + retorno a página original (SignInLink sin useSearchParams) | Vercel prod Ready: https://oda-storefront-6ee5-q9trvmilh-alejingutierrezs-projects.vercel.app
- 2026-02-05 | MC-114 | done | Auth usuarios externos con Descope + perfil + favoritos/listas + experience_events | Servicios locales no levantados; npm install @descope/nextjs-sdk se colgó (package-lock sin actualizar); sin push ni verificación de build/Vercel.
- 2026-02-05 | MC-113 | fix | Mega menu mantiene hover sobre panel | docker-compose no existe (repo des-dockerizado), por lo que no se pudo rebuild ni revisar logs locales; push OK; Vercel prod Ready: https://oda-storefront-6ee5-l7uvtcw76-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante observación).
- 2026-02-05 | MC-113 | done | Ajustes home: ancho de layout, mega menu fijo/ancho, menu mobile, menos radio en fotos | docker-compose no existe (repo des-dockerizado), por lo que no se pudo rebuild ni revisar logs locales; push OK; Vercel prod Ready: https://oda-storefront-6ee5-gd0366d5c-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante observación).
- 2026-02-04 | MC-113 | done | Home editorial + mega menu + rotación 3 días | docker-compose no existe (repo des-dockerizado), por lo que no se pudo rebuild ni revisar logs locales; README/User Stories/Backlog actualizados; push OK; Vercel prod Ready: https://oda-storefront-6ee5-h5rmrt76g-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante observación).
- 2026-02-04 | fix | Cobertura color-combinations ~98% | build-color-relations ahora mapea aliases y nombres de producto a standard colors + fallback de matches; rebuild completo de relaciones (variants 439,582 con match).
- 2026-02-04 | MC-112 | done | Des-dockerizar repo y docs | Dockerfiles/compose removidos; README/AGENTS/Backlog/User Stories actualizados; ejecución local vía npm; Vercel prod Ready: https://oda-storefront-6ee5-caz5rgigz-alejingutierrezs-projects.vercel.app.
- 2026-02-04 | MC-111 | done | Paleta 200 + matching estandarizado de combinaciones + admin actualizado | Docker build OK; web/worker healthy; scraper stub exit 0; `.dockerignore` agregado en `apps/web`; Vercel prod Ready: https://oda-storefront-6ee5-5e9idl2fk-alejingutierrezs-projects.vercel.app (runtime logs sin eventos en ventana corta).
- 2026-02-04 | MC-110 | done | Refresh semanal de catálogo + panel admin + cobertura/alertas + auto‑recover + VTEX discovery completo | Docker rebuild omitido por solicitud; lint se colgó y se abortó; pruebas VTEX via API (tennis/co.totto/mariohernandez/velez/studiof) muestran totales >1k; Vercel prod Ready: https://oda-storefront-6ee5-dt85iqjvh-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la observación).
- 2026-02-03 | deploy | Vercel prod Ready tras fix onboarding | https://oda-storefront-6ee5-d9zbsitfj-alejingutierrezs-projects.vercel.app
- 2026-02-03 | fix | Prisma JSON typing en onboarding | `OnboardingStepInfo.detail` ahora usa `Prisma.JsonValue` y persistencia serializa `onboarding` antes de guardar metadata.
- 2026-02-03 | fix | Vercel build: refreshOnboardingState before declaration | Ajustado orden de hooks en BrandDirectoryPanel para resolver TypeScript error de build.
- 2026-02-03 | MC-109 | done | Onboarding de marca desde modal (pipeline secuencial + progreso) | Docker rebuild omitido por solicitud; lint se colgó y se detuvo; build local se quedó en `prisma generate` y se detuvo; Vercel prod: deploy en Error `https://oda-storefront-6ee5-36esxrxdc-alejingutierrezs-projects.vercel.app` (inspect muestra dpl_D4giyXA4896pEheTo7B5hyP9xz17; CLI no devuelve logs porque está en Error); `vercel --prod` falla por `vercel.json` fuera de `apps/web` (rootDirectory).
- 2026-02-03 | MC-108 | done | Cola scraping marcas: encolar solo pendientes + drenar cola existente | Docker rebuild omitido por solicitud; smoke test DB OK (old eligible 440 vs new 6). Vercel prod Ready: https://oda-storefront-6ee5-i768gw7ga-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la observación).
- 2026-01-29 | MC-107 | done | Enrichment Bedrock estricto + repair/chunking + concurrency 40 | Docker rebuild ok; logs web/worker OK; scraper stub exit 0 (sitemap 404 esperado). Vercel prod Ready: https://oda-storefront-6ee5-1y1zlqmio-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revisión).
- 2026-01-29 | MC-106 | done | Estilos principal/secundario por styleTags | Docker rebuild ok; logs web/scraper OK; worker local con Redis OOM (maxmemory); migración aplicada manualmente en Neon por lock de Prisma; Vercel prod Ready: https://oda-storefront-6ee5-ax65i39f0-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante observación).
- 2026-01-29 | fix | Color combinations: filtro global por categorias permitidas | Docker rebuild ok; logs web/worker/scraper OK (warning sslmode).
- 2026-01-29 | MC-105 | done | Filtro por rol de color en combinaciones | Docker rebuild ok; logs web/worker/scraper OK (warning sslmode); Vercel preview Ready: https://oda-storefront-6ee5-ijobh21ni-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Bedrock AbortError: retry sin imágenes + límite imágenes | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-plzxe6lv9-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Enrichment: quitar sesgo de category/subcategory + nueva taxonomía (calzado/bolsos/gafas) | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-lgivhj99i-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Enrichment: descripciones detalladas de categoría/subcategoría | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-6ta234wdj-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Enrichment: timeout Bedrock para evitar timeouts en drain | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-3qro7ms4r-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Enrichment: jsonrepair para JSON no estricto en Bedrock | Docker rebuild ok; logs web/worker/scraper OK; Vercel preview Ready: https://oda-storefront-6ee5-bh957xdwt-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Enrichment: description texto plano + Bedrock sin top_p | Docker rebuild ok; logs web/worker/scraper OK; Vercel preview Ready: https://oda-storefront-6ee5-8i5ltci85-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Enrichment: metales en materiales + JSON más estricto | Docker rebuild ok; logs web/worker/scraper OK; Vercel preview Ready: https://oda-storefront-6ee5-g0ynnr056-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Enrichment: fallback para style_tags < 10 | Docker rebuild ok; logs web/worker/scraper OK; Vercel preview Ready: https://oda-storefront-6ee5-npf9jc723-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | fix | Bedrock enrichment: repair JSON + subcategory estricta | Docker rebuild ok; logs web/worker/scraper OK; Vercel preview Ready: https://oda-storefront-6ee5-oyfp0f61c-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | MC-104 | done | Enrichment productos con Claude Bedrock | Docker rebuild ok; logs web/worker/scraper OK; Vercel preview Ready: https://oda-storefront-6ee5-nucgmontm-alejingutierrezs-projects.vercel.app (runtime logs sin eventos); envs AWS/Bedrock creados en Vercel.
- 2026-01-28 | fix | Productos: filtro no fuerza brandId + prompt enrichment multicolor/unisex | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-iwekfjqq9-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revisión).
- 2026-01-28 | fix | Enrichment: batch/queue floor a concurrencia efectiva | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-6mix5s7ab-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revisión).
- 2026-01-28 | fix | Duplicar concurrencia product-enrichment a 20 | Drain y worker con clamp mínimo 20; requiere redeploy worker/containers + Vercel.
- 2026-01-28 | fix | Concurrencia worker product-enrichment mínimo 10 | Ajuste default + clamp en worker; requiere redeploy de worker/containers.
- 2026-01-28 | fix | Concurrencia mínima 10 en drain de product-enrichment | Vercel prod Ready: https://oda-storefront-6ee5-m336ytr9u-alejingutierrezs-projects.vercel.app.
- 2026-01-28 | fix | Enrichment progreso sin pendientes fantasma | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-zb7f46bpa-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | MC-103 | done | Campos SEO en productos + enrichment v4 | Docker rebuild ok; logs web/scraper OK; worker local 500 por migracion pendiente; migrate deploy a Neon falló (P1002 advisory lock). Vercel prod Ready: https://oda-storefront-6ee5-8iuwzeuqf-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | MC-102 | done | Enrichment panel: URL state + progreso realtime + reset batches | Docker rebuild ok; logs web/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-8iuwzeuqf-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
- 2026-01-28 | MC-101 | done | Default OpenAI gpt-5.1 en scrapers/normalizer y docs | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-dtqz0z3yv-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | fix | Modal producto cierra y limpia URL | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-prwldiqf3-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | fix | Batch de marcas sigue tras fallos | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-pjddavzdl-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | fix | Dropdown multi-select categorias en marcas | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-500eckcsu-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | fix | Image-proxy normaliza cdn-cgi | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-9f47v2lqh-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | fix | Imagenes proxy sin optimizacion Next | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-cvb85mdh8-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | fix | Next Image allowlist para Vercel Blob | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-rekme1q93-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | MC-100 | done | Filtro de categorias + orden por productos en /admin/brands | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-dsuybazz1-alejingutierrezs-projects.vercel.app (runtime logs sin eventos durante la revision).
- 2026-01-27 | MC-099 | done | Contador pendientes marcas con desglose diagnostico | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod Ready: https://oda-storefront-6ee5-y4ptk4uh7-alejingutierrezs-projects.vercel.app (runtime logs sin errores visibles durante la revision).
- 2026-01-27 | MC-098 | done | Proxy/cache de imágenes para servir más rápido desde Blob/CDN | Docker rebuild ok; logs web/scraper OK (worker con fallos Woo puntuales ya conocidos); Vercel prod Ready: https://oda-storefront-6ee5-7ut4mzww0-alejingutierrezs-projects.vercel.app (runtime logs sin errores visibles durante la revisión).
- 2026-01-27 | MC-097 | done | Persistencia de navegación en admin (page/filter en URL) | Docker rebuild ok; logs web/scraper OK; worker sin OOM; vercel prod OK: https://oda-storefront-6ee5-158nqgnat-alejingutierrezs-projects.vercel.app (runtime logs sin eventos); delete A NEW CROSS verificado (brand no existe y 0 huérfanos).
- 2026-01-27 | MC-096 | done | Modal marcas: stats reales + preview + delete cascada | Docker rebuild ok; logs web/scraper OK; worker Redis OOM mitigado limpiando ~40k keys `bull:*` y reiniciando worker; README/Backlog/User Stories actualizados.
- 2026-01-26 | MC-095 | done | UI: marcas sin run agrupadas por tecnología + límite por plataforma 2000 | Docker rebuild ok; logs web/scraper OK; Redis OOM resuelto limpiando ~42k keys bull:* y reiniciando worker; Vercel prod OK: https://oda-storefront-6ee5-jexf1wgfl-alejingutierrezs-projects.vercel.app (logs sin eventos visibles).
- 2026-01-25 | MC-094 | done | Sitemap discovery tolerante a fallos (fetch failed) | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod OK: https://oda-storefront-6ee5-5yjleqz98-alejingutierrezs-projects.vercel.app (deploy dpl_AxmzmhvWw2XoVDXrt373Ug1TTJmp, logs sin eventos en 1h).
- 2026-01-25 | MC-093 | done | Sitemap completo sin corte temprano + límite configurable | Docker rebuild ok; logs web/worker/scraper OK (warning sslmode); Vercel prod OK: https://oda-storefront-6ee5-4u1578k2v-alejingutierrezs-projects.vercel.app (deploy dpl_HPnN2t7fzRzhhLmD9L8zzr4iyS5n, logs sin eventos en 1h).
- 2026-01-25 | MC-092 | done | Reducir reintentos de catálogo | Docker rebuild ok; logs web/worker/scraper OK (warning sslmode); Vercel prod OK: https://oda-storefront-6ee5-4mpkvvs4o-alejingutierrezs-projects.vercel.app (deploy dpl_8BBkqXoW69RJHaJnwoCKeWPqV9bp, logs sin eventos).
- 2026-01-25 | MC-091 | done | Drain finaliza runs idle + control sitemap/queue | Docker rebuild ok; logs web/worker/scraper OK (warning sslmode); Vercel prod OK: https://oda-storefront-6ee5-izjoexjup-alejingutierrezs-projects.vercel.app (deploy dpl_GtGdfJ7TzEawz3WsWZb5KquMByQe, logs sin eventos).
- 2026-01-25 | MC-090 | done | Sitemap budget + precios Woo fallback | Docker rebuild ok; logs web/worker/scraper OK (warning sslmode); Vercel prod OK: https://oda-storefront-6ee5-b7n0zyw6g-alejingutierrezs-projects.vercel.app (deploy dpl_9m7ZAtqa9F2Uta9WvyNqftPV5LdN, logs sin eventos).
- 2026-01-25 | MC-084 | fix | Stop extractor ahora limpia jobs en cola y resetea items | Docker rebuild ok; docker-compose up ok; stop aplicado a 2 marcas activas (Bibiana Pineda Joyas, Love Culture).
- 2026-01-25 | MC-083 | fix | Coerce externalId/sku a string para evitar error Prisma en Woo | Docker rebuild ok; docker-compose up ok; logs saludables.
- 2026-01-25 | MC-089 | done | Concurrencia alta + progreso frecuente en extractor | Docker rebuild ok; logs web/worker/scraper OK; progreso usa runState live; Vercel prod OK: https://oda-storefront-6ee5.vercel.app (deploy dpl_CbZswEHcsuoEM5miLxhgGoMyzdo4).
- 2026-01-25 | MC-088 | done | Catalog extractor sin pausa por errores soft | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod OK: https://oda-storefront-6ee5.vercel.app (deploy dpl_96jMabmxTGtcBx5qtU6iz7JnXmDA).
- 2026-01-25 | MC-087 | done | Modal productos + carrusel en cards | Docker rebuild ok; logs web/worker/scraper OK; Vercel prod OK: https://oda-storefront-6ee5.vercel.app (deploy dpl_8T6XGHVMRQ4qtHTfBdeC7RUcbmUG).
- 2026-01-25 | MC-085 | done | Style tags exactos 10 | Docker rebuild: ok; logs web/worker/scraper OK.
- 2026-01-25 | MC-084 | done | Auto‑refresh enrichment solo con runs processing | Docker rebuild: ok; logs web/worker/scraper OK.
- 2026-01-25 | MC-083 | done | Estabilidad product‑enrichment (drain cron + auto‑refresh) | Docker rebuild: ok; Vercel prod OK: https://oda-storefront-6ee5.vercel.app; endpoint drain probado (200).
- 2026-01-25 | MC-082 | done | Normalizacion determinista v2 (reglas extendidas) | Docker rebuild ok; docker-compose up ok; logs web/worker/scraper saludables (warning sslmode); vercel build local OK; Vercel preview OK: https://oda-storefront-6ee5-git-mc-081-c37d8b-alejingutierrezs-projects.vercel.app
- 2026-01-25 | MC-081 | done | Catalog extractor: normalizacion determinista + menos OpenAI + retries cola | Docker rebuild: fallo (daemon apagado); vercel build local OK; Vercel preview OK: https://oda-storefront-6ee5-git-mc-081-c37d8b-alejingutierrezs-projects.vercel.app
- 2026-01-24 | MC-080 | done | Enriquecimiento IA de productos (admin + cola + GPT-5 mini) | Docker rebuild: falló (daemon apagado); migración `20260124123000_product_enrichment` aplicada en Neon; Vercel prod OK: https://oda-storefront-6ee5.vercel.app; prueba batch 10 random OK (10/10).
- 2026-01-23 | MC-079 | fix | Auto‑Play all no se detiene tras primera marca | Vercel prod OK: https://oda-storefront-6ee5-cnktphvd0-alejingutierrezs-projects.vercel.app
- 2026-01-23 | MC-078 | done | Botón Auto‑Play para recorrer todas las marcas sin selección manual | Vercel prod OK: https://oda-storefront-6ee5-e9bxrn5om-alejingutierrezs-projects.vercel.app
- 2026-01-23 | MC-077 | done | Auto-play selecciona marcas sin productos y encadena siguiente | Vercel prod OK: https://oda-storefront-6ee5-kvt8951mv-alejingutierrezs-projects.vercel.app
- 2026-01-23 | MC-076 | done | PDP LLM sin temperature en gpt-5 (evita 400) | Vercel prod OK: https://oda-storefront-6ee5-8tb3bbgn0-alejingutierrezs-projects.vercel.app
- 2026-01-23 | MC-075 | done | Errores no detienen extractor (sin auto‑pause) + auto‑resume continuo | Vercel prod OK: https://oda-storefront-6ee5-hnw0qqnzc-alejingutierrezs-projects.vercel.app (CATALOG_AUTO_PAUSE_ON_ERRORS=false).
- 2026-01-23 | MC-074 | done | Resume robusto (barrido + drain ilimitado por tiempo) y Blob path safe (#/?) | Vercel prod OK: https://oda-storefront-6ee5-54lb6safv-alejingutierrezs-projects.vercel.app (envs drain/resume actualizadas).
- 2026-01-23 | MC-073 | done | Drain serverless catálogo con cron Vercel | Build local OK (env); Vercel prod OK: https://oda-storefront-6ee5-8qznsuruv-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-23 | MC-072 | done | Redis + cola operativa en Vercel (guardas + timeout) | Docker rebuild: no ejecutado (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-65dxt41qs-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-23 | MC-071 | done | Blob robusto: sanitizar path + tolerar fallos parciales | Build local OK (env); Vercel prod OK: https://oda-storefront-6ee5-qiuv3hfhu-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-23 | MC-070 | done | Concurrencia catálogo v2 (cola + runs/items + backfill) | Build local OK (env); Vercel prod OK: https://oda-storefront-6ee5-qiuv3hfhu-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-23 | MC-069 | done | Telemetría de extractor + pausa por errores consecutivos | Docker rebuild: no requerido; build local OK (env); Vercel prod OK: https://oda-storefront-6ee5-htp4h72kw-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-23 | MC-068 | done | Resume UI + barrido de URLs + GPT-5 mini en productos | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-d0jxgupfa-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-23 | MC-067 | done | Detener extractor conserva estado y permite reanudar | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-78a47fh4x-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-23 | MC-066 | done | Catalog extractor: finalizar marca y sacarla de la cola | Docker rebuild: ok; servicios locales OK; Vercel pendiente (sin acceso).
- 2026-01-23 | MC-065 | done | LLM PDP fallback + limpieza de marcas | Docker rebuild: ok; servicios locales OK; Vercel pendiente.
- 2026-01-22 | MC-064 | done | Normaliza ImageObject antes de subir a Blob | Docker rebuild: ok; Vercel prod OK: https://oda-storefront-6ee5-l2c89z1w0-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-22 | MC-063 | done | Blob retry con referer/UA | Docker rebuild: ok; Vercel prod OK: https://oda-storefront-6ee5-bcdhvfxlm-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-22 | MC-062 | done | Custom: omite sitemap sin PDPs + excluye /portafolio | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app (alias).
- 2026-01-22 | MC-061 | done | Unknown: sitemaps extra + inferencia rápida plataforma sin LLM | Docker rebuild: falló (daemon apagado); pruebas rápidas con tsx no ejecutables por alias `@/` fuera de tsconfig; Vercel prod OK: https://oda-storefront-6ee5-bv62sxd1m-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-22 | MC-060 | done | Custom adapter filtra listados por og:type/rutas | Docker rebuild: falló (daemon apagado); pruebas unknown con PDPs OK (Derek, Lyenzo, Zuahaza); Vercel prod OK: https://oda-storefront-6ee5-38wsp1vwl-alejingutierrezs-projects.vercel.app.
- 2026-01-22 | MC-059 | done | Custom adapter evita listados y acepta pistas de PDP sin JSON-LD | Docker rebuild: falló (daemon apagado); ejecución batch tech profiler completada; Vercel prod OK: https://oda-storefront-6ee5-inhkc67k2-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-22 | MC-058 | done | Mejoras unknown: tech profiler Tiendanube/Wix + parked/unreachable + patrones de producto | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-eh4orhbg9-alejingutierrezs-projects.vercel.app (logs sin eventos).
- 2026-01-22 | MC-057 | done | Marca manualReview cuando no hay productos detectables | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-836cmfy95-alejingutierrezs-projects.vercel.app
- 2026-01-22 | MC-056 | done | Filtra URLs de sitemap por mismo dominio | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-7xssnhjib-alejingutierrezs-projects.vercel.app
- 2026-01-22 | MC-055 | done | Fallback a API cuando sitemap no trae productos (evita URLs no-producto en VTEX) | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-iq7spmpy5-alejingutierrezs-projects.vercel.app
- 2026-01-21 | MC-054 | done | Sitemap discovery full (index/gz) + fallback HTML Woo/VTEX + smoke test por tecnología | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-ppznfqdln-alejingutierrezs-projects.vercel.app (logs sin eventos en tail).
- 2026-01-21 | MC-053 | done | VTEX: linkText desde URL en sitemap + error con plataforma/URL | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-9pube0ap3-alejingutierrezs-projects.vercel.app
- 2026-01-21 | MC-052 | done | Panel catalog extractor ahora muestra errores y bloqueos | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-6o0cbizja-alejingutierrezs-projects.vercel.app
- 2026-01-21 | MC-051 | done | Catalog extractor por tecnologia: play/pausa/detener, auto‑avance y sitemap‑first con reanudación | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-dfx8rvjsp-alejingutierrezs-projects.vercel.app
- 2026-01-21 | MC-050 | done | Tech profiler sanitiza Unicode y parseo JSON tolerante para evitar 500 por escapes inválidos | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-8nelw4f1b-alejingutierrezs-projects.vercel.app
- 2026-01-21 | MC-049 | done | Default OpenAI vuelve a gpt-5.2 en scrapers/normalizer y docs | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-pz7sc4d9s-alejingutierrezs-projects.vercel.app
- 2026-01-21 | MC-048 | done | Limpieza de evidencia: HTML→texto, filtrado de líneas y priorización por señales relevantes para OpenAI | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5-ilgipaww5-alejingutierrezs-projects.vercel.app
- 2026-01-20 | MC-047 | done | Cambia modelo OpenAI por defecto a gpt-5-mini para scrapers | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-046 | done | Reglas de moneda (USD/COP), parseo de precios, currency en productos + reset catálogo (truncate products/variants) | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-045 | done | Progreso extractor productos (barra informativa + reanudación por tandas + fix OpenAI wrapper) | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-044 | done | Directorio admin de productos (cards + modal, filtro por marca, endpoints /api/admin/products) | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-043 | done | Catalog extractor por tecnología (Shopify/Woo/Magento/VTEX/Custom) con panel `/admin/catalog-extractor`, normalización OpenAI y subida a Blob | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-042 | done | Revisión manual de marcas (check azul en cards + toggle en modal, persistido en DB) | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-041 | done | Tech profiler de marcas (campo ecommercePlatform, panel /admin/brands/tech, API tech profiler) | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-040 | done | Re‑enriquecer por marca (método 2: 14 fuentes, 20k chars) + mini progreso en card | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-039 | done | Cards muestran logo cuando existe y URLs clicables en modal de marca | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-038 | done | Admin con sidebar anclado a la izquierda para ganar espacio de canvas | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-037 | done | Resiliencia scraping admin: re‑encola jobs atascados, auto‑resume tras recarga, /admin/brands separado de /admin/brands/scrape y menú lateral | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-20 | MC-036 | done | Directorio admin de marcas con cards 3x5, modal de detalle, CRUD y filtros/paginación; API CRUD brands | Docker rebuild: falló (daemon apagado); Vercel prod OK: https://oda-storefront-6ee5.vercel.app
- 2026-01-19 | MC-035 | fix | Ajusta botón "Encolar y ejecutar": ahora procesa solo la cantidad encolada (evita drenar cola completa) | Docker rebuild: TLS handshake timeout con docker.io; Vercel prod OK: https://oda-storefront-6ee5-jpvx4krxz-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Ajusta web_search: query única con instagram, tool config CO/high y alerta si <10 fuentes | Docker rebuild: error Docker API 500; Vercel prod OK: https://oda-storefront-6ee5-8er10tg0o-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Sanitiza texto para evitar Unicode inválido en metadata (surrogates/control chars) | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-435cz194p-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Coerción de sources.other a strings (url/title) para evitar fallos de validación OpenAI | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-gnw7hyy47-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Normaliza payload OpenAI: coerce para opening_hours (string→obj/null), sources.website (array→string), y lat/lng desde string | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-iqrt6ftb5-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Aumenta evidencia a 10k caracteres por fuente en enrichment de marcas | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-g11gbakrb-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Evidencia web mínima 7 fuentes: fetch HTML de fuentes, extracción de texto/título, se pasa como evidence_texts a OpenAI y se guarda en metadata | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-a1v57ppob-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Mejora UI de diff en admin: muestra solo campos cambiados con antes/después legible | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-97sbtpmql-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Mejora calidad de datos de marcas: se agregan señales multi‑página (contacto/ubicación), parsing de JSON-LD @graph/sameAs, extracción de lat/lng en mapas/meta/data, prompt con evidencia y fallback a valores existentes | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-qbk546zju-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | fix | Corrige 500 en `/api/admin/brands` por conteos BigInt (casts a int en summary) | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-kctrrzw34-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-035 | done | Scraper de marcas con cola (1/5/10/25/50), panel /admin/brands, endpoints admin + cron, tabla completa de marcas con diff antes/después y enriquecimiento OpenAI web search + fallback HTML, tabla brand_scrape_jobs | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-juzgjesbw-alejingutierrezs-projects.vercel.app
- 2026-01-19 | MC-006 | done | Login admin (email/password + cookie), seed admin en Neon, /admin directo, middleware sólo en /api/normalize; carga Excel a columnas (incluye ratings) | Docker rebuild ok; Vercel prod OK: https://oda-storefront-6ee5-8wm8f249r-alejingutierrezs-projects.vercel.app
- 2026-01-19 | meta | done | Sync repo con origin, fixes build Vercel (OpenAI lazy client + Node 22), docker compose healthy (web/worker/db/redis) | Vercel preview OK: https://oda-storefront-6ee5-o4pjm62bz-alejingutierrezs-projects.vercel.app
- 2026-01-15 | MC-001 | done | Estructura base repo (Next TS/Tailwind), servicios scraper/worker stub, docker-compose, .env.example, README inicial; envs creadas en Vercel (prod/preview/dev) | Build local ok (lint/build); Vercel deploy productivo OK (https://oda-storefront-6ee5-hdg0yo8xc-alejingutierrezs-projects.vercel.app); stack docker corriendo en host puerto 3080.
- 2026-01-15 | meta | done | Limpieza de variables duplicadas en Vercel (prefijo `oda_*` removido) y carga de credenciales Neon/Blob finales | Env set consolidado; pendiente acceso del autor correcto para deploy.
- 2026-01-15 | meta | done | Deploy Vercel producción OK | https://oda-storefront-6ee5-hdg0yo8xc-alejingutierrezs-projects.vercel.app
- 2026-01-15 | MC-002 | done | Docker compose local con web/scraper/worker, Postgres pgvector, Redis; healthchecks y puerto 3080 para web; envs alineadas con Vercel | `docker-compose up -d` exitoso; warning de NODE_ENV en Next pendiente de afinado pero servicio operativo.
- 2026-01-15 | MC-003 | done | Esquema inicial + migración Prisma (brands, stores, products, variants, price/stock history, assets polimórficos, taxonomy_tags, users, events, announcements) con pgvector | Migración `20260115125012_init_schema` aplicada en DB local (pgvector habilitado); Prisma client generado.
- 2026-01-15 | MC-004 | done | Cliente OpenAI GPT-5.2 con retries y validación Zod; endpoint `/api/normalize`; middleware Bearer (ADMIN_TOKEN/NEXTAUTH_SECRET) protegiendo admin/API; README actualizado; build y lint ok | Deploy Vercel incluye /admin y /api/normalize.
- 2026-01-25 | MC-086 | done | Progreso incremental product-enrichment (no drain en run) | Docker rebuild ok; servicios healthy; Vercel prod OK: https://oda-storefront-6ee5-qe83zgip0-alejingutierrezs-projects.vercel.app (runtime logs sin eventos).
