# Backlog

## Now (F0 ‚Äì bootstrap E2E m√≠nimo)
- MC-005 | todo | P0 | Primer scraper E2E | Descubrir sitemap marca piloto, parsear, enviar a GPT-5.1, upsert DB, ficha en VSF + ISR.
- MC-007 | todo | P1 | CI lint/test smoke | GitHub Actions: lint, type-check, unit smoke; build base.
- MC-008 | todo | P1 | Observabilidad m√≠nima | Logging estructurado, health checks, traces b√°sicos; dashboard inicial de servicios.

## Next (F1 ‚Äì primeras capacidades)
- MC-010 | todo | P1 | B√∫squeda b√°sica + pgvector | Index texto/embeddings, endpoint search, listados VSF, m√©tricas de calidad.
- MC-011 | todo | P1 | Observabilidad scraping v1 | M√©tricas por marca, staleness, alertas b√°sicas, dashboard.
- MC-012 | todo | P2 | Admin m√≠nimo | Login, CRUD marcas/tiendas, salud scraper, aprobaci√≥n manual de normalizaciones IA.
- MC-013 | todo | P2 | Anuncios b√°sicos | Modelo de placements, serving simple, tracking impresiones/clicks.
- MC-014 | todo | P1 | 10‚Äì20 marcas integradas | Parsers templated, scheduler adaptativo, cobertura inicial.
- MC-015 | todo | P2 | Emails y plantillas | SMTP/SendGrid, plantillas de servicio, opt-in/opt-out, logs de env√≠o.
- MC-017 | todo | P1 | Gesti√≥n de secrets/entornos | Matriz local/stg/prod, rotaci√≥n, docs de configuraci√≥n.

## Later (F2‚ÄìF3 ‚Äì escalado y premium)
- MC-018 | todo | P1 | Recomendador h√≠brido v1 | Embeddings texto/imagen, kNN, reglas stock/talla, API de similares.
- MC-019 | todo | P1 | Recomendaciones proactivas + alertas | Back-in-stock, drops, email/push, control por plan.
- MC-020 | todo | P1 | Planes pagos Wompi | Checkout suscripci√≥n, webhooks, flags de features, facturaci√≥n.
- MC-021 | todo | P2 | Try-on IA MVP | Upload seguro a Blob, pipeline async, expiraci√≥n de assets, UX b√°sica.
- MC-022 | todo | P2 | Panel advertiser | Campa√±as, budget, targeting simple, reporting CTR/CPA.
- MC-023 | todo | P2 | Versionado de prompts + FinOps IA | Costos por marca, l√≠mites diarios, dashboards de drift/error rate.
- MC-024 | todo | P1 | Escalado a 100+ marcas | Pool de proxies, crawler de respaldo, priorizaci√≥n por rotaci√≥n/frescura.
- MC-025 | todo | P2 | Data quality & drift dashboard | Campos faltantes, duplicados, staleness, drift de modelo IA.
- MC-026 | todo | P2 | Gesti√≥n de colas y reintentos | Retries exponenciales, DLQ, priorizaci√≥n por marca/frescura.
- MC-027 | todo | P2 | Segmentaci√≥n estilo/ocasi√≥n + A/B ranking | Experimentos, cohortes, m√©tricas autom√°ticas.
- MC-028 | todo | P2 | Store locator enriquecido | Geocodificaci√≥n, horarios/tel√©fonos/redes actualizados, UX de mapa.
- MC-029 | todo | P2 | Seguridad y privacidad reforzada | WAF, rate limit afinado, borrado/anonimizaci√≥n try-on, auditor√≠a completa.
- MC-030 | todo | P2 | Optimizaci√≥n de costos infra | Cache de inferencias sin cambios, compresi√≥n de assets, tuning colas/batch.
- MC-031 | todo | P2 | Despliegue prod Vercel + contenedores workers | Ramas stg/prod, CI/CD completo, monitoreo post-deploy.
- MC-032 | todo | P1 | Cobertura 500 marcas | Escalado scraping, acuerdos con marcas clave, SLAs de frescura.
- MC-033 | todo | P2 | Legal/compliance y pol√≠ticas | T√©rminos, privacidad, manejo de robots, procesos de takedown, retenci√≥n de datos.
- MC-034 | todo | P2 | Performance & resiliencia front | Budgets CWV, fallbacks, manejo de errores de cat√°logo.

## Done (2026-02)
- MC-136 | done | P1 | Correcci√≥n de precios: COP exacto, USD con redondeo marketing | Se cre√≥ `src/lib/price-display.ts` para centralizar regla de display (`COP` sin redondeo marketing; `USD`/override `USD` con redondeo), aplicado en cat√°logo/home/compare/admin/favoritos/listas; `CatalogoFiltersPanel` pas√≥ a step din√°mico de precio y la se√±al de cambio de precio (`catalog/extractor` + `backfill-product-price-change-signals.mjs`) qued√≥ alineada con la misma sem√°ntica condicional.
- MC-114 | done | P1 | Auth Descope: UX sin `Reintentar` para `E061301` + anti-loop de `next` | `SignInClient` resuelve `/sign-in?code=...` con bootstrap + `oauth.exchange` controlado (una sola vez por c√≥digo) cuando no hay sesi√≥n local; `E061301` se maneja como carrera recuperable con poll corto y sin UX de error. Adem√°s, `next/returnTo` se sanitiza para bloquear destinos auth (`/sign-in`, `/auth/callback`) y query params OAuth, evitando bucles de login.
- MC-114 | done | P1 | Auth Descope: fix `E108202` (dominio no aprobado) + hardening de diagn√≥stico en `/sign-in` | Se actualizaron `trustedDomains` del proyecto en Descope (prod + alias `git-main` + localhost), y la UI de login ahora parsea `CustomEvent.detail` para mapear `errorCode` (incluye mensaje expl√≠cito para `E108202` con host actual) y log estructurado (`hostname`, `flowId`, `projectId`, `errorCode`, `errorDescription`).
- MC-135 | done | P1 | PLP: indicador/filtro de cambio de precio + filtro de ocasi√≥n | Se a√±adi√≥ se√±al persistida en `products` (`priceChangeDirection`, `priceChangeAt`) calculada por cambio de precio m√≠nimo visible (redondeo marketing), filtro `price_change=down|up` con ventana de 30 d√≠as, chip en cards (`‚Üì/‚Üë`) junto al precio, secci√≥n ‚ÄúOcasi√≥n‚Äù en filtros desktop/mobile v√≠a `facets-lite.occasions`, noindex SEO para `price_change`, √≠ndice parcial de soporte y script de backfill inicial desde `price_history`.
- MC-134 | done | P1 | Home inmersivo editorial (SSR + islas client) | Redise√±o integral del home `/` con estrategia SSR + islas: hero full-bleed parallax, `RevealOnScroll`, carruseles swipe/drag para Novedades y Trending, galer√≠a 3:4 de categor√≠as, `CuratedStickyEdit`, paleta `Shop by color` asim√©trica, marquee infinito de marcas y nuevo `HomeProductCard` vertical 3:4. Se a√±adieron `framer-motion` + `lucide-react`, se cre√≥ `src/lib/home-types.ts` para desacoplar tipos de `home-data` (`server-only`) y se mantuvo intacta la semilla determinista de 3 d√≠as + fetch server-side.
- MC-133 | done | P1 | Curaci√≥n programada + se√±ales editoriales (‚ù§Ô∏è/üëë) + sorts PLP | `/admin/product-curation` migra a cola persistente compartida (composer en modal, panel lateral de cola, aplicar pendientes global, aplicar/duplicar/eliminar por item, conflictos potenciales y quick actions ‚ù§Ô∏è/üëë por card). Backend nuevo: `product_curation_queue_items`, `product_curation_apply_runs`, endpoints `/api/admin/product-curation/queue*`, motor √∫nico `apply-engine` reutilizado por `/bulk`. Cat√°logo p√∫blico agrega sorts `top_picks` y `editorial_favorites` sin badges p√∫blicos.
- MC-133 | done | P1 | PLP `/catalogo`: correcci√≥n de filtro de precios (histograma + UX + performance medible) | Histograma de precio orientado a productos (no conteo bruto de variantes) con fast-path por rollups y dedupe por `productId` por bin; fast-path `price-only` (sin `color/size/fit`) en `products-count/products-page/products` usando `products.minPriceCop/maxPriceCop/hasInStock`; `mode=full` de `price-bounds` pasa a fetch bajo demanda en UI (solo cuando el usuario interact√∫a con Precio); tooltip de slider con edge-clamp en min/max; dock mobile con lock duro + scrim/loading + watchdog hasta navegaci√≥n estable; benchmark actualizado con desglose `cold/warm` por endpoint/escenario (`base`, `price_min_max`, `price_range`) y validaci√≥n SLO (`warm <1.2s`, `cold <3s`).
- MC-132 | done | P1 | Header + mega menu: fix ancho achatado + redise√±o UX desktop/mobile | Header desktop migra a grid (`auto | minmax(0,1fr) | auto`) con buscador responsive `clamp`; mega menu desktop pasa a estado controlado (hover + pin por click, cierre por outside/Esc, panel compartido a ancho completo del container y scrim √∫nico); menu mobile migra a drawer jer√°rquico por niveles (root/g√©nero/secci√≥n) con barra sticky y navegaci√≥n atr√°s; se agrega telemetr√≠a de eventos `menu_open`, `menu_pin_toggle`, `menu_item_click`, `menu_mobile_step`.
- MC-132 | done | P1 | Mega menu UX polish: densidad desktop + reglas de subcategor√≠as | Se compact√≥ el espaciado vertical de l√≠neas en desktop, se elimin√≥ el desglose especial de `ropa_deportiva_y_performance` y se ocultaron subcategor√≠as sin productos (`count=0`) en desktop/mobile.
- MC-130 | done | P1 | Moneda por marca (USD) + TRM editable + redondeo marketing (xxxx0000) | Auto-clasificaci√≥n diaria de marcas USD (>75% muestra: variantes USD o COP < 1999), override por marca en `brands.metadata.pricing`, TRM configurable en admin (KV `standard_color_config:pricing_config`), UI siempre en COP con conversi√≥n USD‚ÜíCOP y redondeo display a m√∫ltiplos de 10.000 COP; cron Vercel diario + bot√≥n manual en `/admin/pricing`.
- MC-131 | done | P1 | PLP `/catalogo`: sort por precio sin timeout con rollups persistidos | Se agregaron rollups en `products` (`hasInStock`, `minPriceCop`, `maxPriceCop`, `priceRollupUpdatedAt`), script de backfill (`backfill-product-price-rollups.mjs`), fast-path de queries para `price_asc/price_desc` y `price-bounds` (lite) usando `products` cuando no hay filtros de variante, fallback al query pesado cuando s√≠ los hay, e √≠ndices concurrentes de soporte para orden por precio (global, por `category` y por `category+subcategory`).
- MC-125 | done | P1 | PLP `/catalogo`: corregir outliers de precio (rangos astron√≥micos) y estabilizar orden por precio | Se aplic√≥ guardia de precio v√°lido (`CATALOG_PRICE_MAX_VALID`, default 100M COP) en c√°lculo de bounds, min/max de cards y sort `price_asc/price_desc`; adem√°s, `/api/catalog/price-bounds` vuelve a exponer `bounds+stats+histogram` y la ingesti√≥n sanea precios fuera de rango para no persistir nuevos outliers.
- MC-125 | done | P1 | PLP `/catalogo`: estabilizar filtro de precio evitando saturaci√≥n por prefetch de navegaci√≥n | Se desactiv√≥ `prefetch` en links del header/mega menu (desktop + mobile) para evitar r√°fagas de requests `_rsc` que compet√≠an con transiciones de filtros y dejaban estados ‚ÄúActualizando‚Ä¶‚Äù prolongados.
- MC-125 | done | P1 | PLP `/catalogo`: hardening de filtros al volver de pesta√±a inactiva + scroll infinito m√°s estable | Se agreg√≥ guardia anti-bloqueo en transiciones de filtros (timeout + release en focus/visibility/pageshow), se evitaron `router.replace` no-op en filtros/dock mobile, y se reforz√≥ infinite scroll con timeout/abort en `loadMore/prefetch`, reintento por eventos `focus/online/pageshow` y fallback por proximidad real al sentinel.
- MC-128 | done | P1 | PLP `/catalogo`: debounce de filtros en desktop + `price-bounds` `mode=lite/full` + √≠ndices GIN para tags | Desktop: panel de filtros en modo draft con auto-apply (400ms) para seleccionar varios filtros sin m√∫ltiples navegaciones. Precio: `/api/catalog/price-bounds` soporta `mode=lite|full` y la UI carga bounds r√°pido y insights completos lazy. DB: √≠ndices GIN parciales para `materialTags/patternTags/seoTags/occasionTags` + script Node para aplicarlos sin `psql`.
- MC-129 | done | P1 | PLP (SEO + filtros): rutas can√≥nicas, facets contextuales, conteos reales y generador SEO (Bedrock) | Canonical PLP `/{femenino|masculino|unisex|infantil}/...` (308 desde `/g/*`), facets-lite contextual (marcas por conteo desc + patr√≥n), chips subcategor√≠a operativos, contador real de marcas, toggle mobile por iconos y panel `/admin/plp-seo` con generaci√≥n Bedrock persistida en `plp_seo_pages` (runs/items + worker BullMQ).
- MC-016 | done | P1 | ISR/Cache y performance | PLP `/catalogo`: filtros <2s con √≠ndices DB (Neon) + hardening UI de subcategor√≠as; benchmark reproducible.
- MC-125 | done | P1 | Cat√°logo p√∫blico: refinamientos PLP `/catalogo` (mobile + precio + cards) | Desktop: categor√≠as top 10 con scroll + hint, barra de filtros m√°s angosta, toolbar con iconos (guardar/limpiar) y guardados con delete visible. Mobile: dock fijo + toggle de columnas (1/2) en header + formato fijo 3:4 + ancla arriba; men√∫ mobile con scroll interno (no desplaza la p√°gina) y search sin zoom iOS. Precio: histograma y presets m√°s √∫tiles con dominio robusto (percentiles p02/p98) + slider touch + rangos `price_range=min:max` repetibles. Cards: crossfade sin flicker, comparador mobile 1:1, enlaces de producto siempre en nueva pesta√±a.
- MC-126 | done | P1 | PLP `/catalogo`: polish desktop + listas + SEO + header | Desktop: card de ‚ÄúFiltros‚Äù iguala altura con toolbar, columna filtros +20px, scroll por zonas (wheel izquierda mueve filtros), categor√≠as sin scroll anidado (Ver m√°s/menos), toast 6s ‚ÄúAgregar a una lista‚Äù al dar fav + drawer para crear/guardar en listas, indicador fijo de ‚Äú% visto‚Äù sobre bot√≥n Arriba. SEO: metadata/canonical + `noindex` en filtros profundos; `/buscar` canonical a `/catalogo`. Header: avatar sin texto, ‚ÄúIngresar‚Äù consistente, hover mejorado y glass en men√∫s.
- MC-124 | done | P1 | Taxonomy remap: quitar aprendizaje hist√≥rico + batch 10k manual estable | `auto-reseed` elimina la fase de aprendizaje hist√≥rico (accepted/rejected) y usa solo se√±ales directas de producto (nombre/descripcion original/metadata/SEO). Se optimiz√≥ escritura de propuestas con `deleteMany + createMany` por chunk y se subi√≥ `maxDuration` a 300s en rutas de auto-reseed/accept/reject para evitar corridas `running` colgadas. El bot√≥n manual mantiene `limit=10000`; ejecuciones no manuales usan l√≠mite m√°s conservador (2000) para estabilidad y el modo `force` recupera corridas atascadas de larga duraci√≥n (`TAXONOMY_REMAP_AUTO_RESEED_FORCE_RECOVER_MINUTES`).
- MC-124 | done | P1 | Taxonomy remap: hardening aprendizaje + estado running auto-reseed en UI | El aprendizaje ahora ignora ruido (solo toma decisiones donde realmente cambi√≥ categor√≠a/subcategor√≠a/g√©nero), el auto-reseed evita corridas concurrentes con lock persistente (`taxonomy_remap_auto_reseed_runs`, √≠ndice √∫nico parcial `status='running'`), excluye productos ya revisados para no reproponer, y `/admin/taxonomy-remap-review` muestra feedback visual de ejecuci√≥n en curso + √∫ltimo resultado de evaluaci√≥n.
- MC-124 | done | P1 | Taxonomy remap: aprendizaje continuo + auto-reseed por umbral + contador de fase | Nuevo motor `auto-reseed` que aprende de revisiones `accepted/rejected` (nombre/descripcion/SEO), propone cambios para productos enriquecidos y dispara batch autom√°tico (hasta 10.000) cuando pendientes ‚â§ umbral (default 100, con cooldown). Se a√±adieron endpoints `/api/admin/taxonomy-remap/auto-reseed*`, cron dedicado y m√©tricas de fase en `/api/admin/taxonomy-remap/reviews` para mostrar faltantes en `/admin/taxonomy-remap-review`.
- MC-123 | done | P1 | Cola de revisi√≥n manual para remapeo taxon√≥mico (categor√≠a/subcategor√≠a/g√©nero) + panel admin | Se cre√≥ la tabla `taxonomy_remap_reviews` (pending/accepted/rejected), APIs admin para listar/encolar/aceptar/rechazar propuestas y panel `/admin/taxonomy-remap-review` con foto, razones, confianza y acciones de decisi√≥n. Las propuestas SEO-only quedan para revisi√≥n humana (no auto-apply).
- MC-122 | done | P1 | Clasificador manual enrichment: cobertura completa categor√≠as/subcategor√≠as + sin√≥nimos ampliados | Se reforz√≥ `signal-harvester` con scoring por coincidencias (no depende del primer match), se incorpor√≥ diccionario expandido por categor√≠a y se a√±adieron reglas por subcategor√≠a para toda la taxonom√≠a publicada (`CATEGORY_OPTIONS`) con expansi√≥n de sin√≥nimos ES/EN y desambiguaciones (`collar` camisa vs joyer√≠a, `bota` fit de pantal√≥n vs calzado, `body` cosm√©tico vs prenda).
- MC-121 | done | P1 | Product-enrichment: switch runtime a Bedrock Haiku 4.5 (Converse) + visibilidad operativa en admin | Se habilit√≥ el switch real por `PRODUCT_ENRICHMENT_PROVIDER` (OpenAI/Bedrock) sin forzar OpenAI, default recomendado a `BEDROCK_INFERENCE_PROFILE_ID=arn:aws:bedrock:us-east-1:741448945431:inference-profile/us.anthropic.claude-haiku-4-5-20251001-v1:0`, llamada Bedrock migrada a Converse con tool-use y par√°metros de inferencia (`top_k`, `latency`, `stopSequences`). Adem√°s, `/api/admin/product-enrichment/run` reporta `requestedItems/selectedItems` para validar batches y `/admin/product-enrichment` muestra proveedor/modelo/prompt/schema y selecci√≥n solicitada vs creada.
- MC-120 | done | P1 | Catalog-refresh: bloquear auto-ejecuci√≥n de enrichment `new_products` | Hardening para que corridas de `product_enrichment` creadas por `catalog_refresh` con `auto_start=false` no se drenen autom√°ticamente: `/api/admin/product-enrichment/drain` las pausa de forma defensiva (`auto_start_disabled`) y `runCatalogRefreshBatch` tambi√©n normaliza/pausa corridas heredadas en `processing`. Al reanudar manualmente (`/api/admin/product-enrichment/run` con `resume=true`), la metadata marca `auto_start=true`. Nota: el comportamiento puede habilitarse sin intervenci√≥n con `CATALOG_REFRESH_ENRICH_AUTO_START=true` (reanuda corridas legacy y crea nuevas en `processing`).
- MC-119 | done | P1 | Product-enrichment: ejecutar nuevo vs reanudar expl√≠cito + conteo de batch consistente | El panel `/admin/product-enrichment` deja de auto-reanudar corridas al ejecutar batch/all: ahora esos botones siempre crean corrida nueva (`startFresh`), y se agrega bot√≥n expl√≠cito para reanudar. El endpoint `/api/admin/product-enrichment/run` toma `startFresh=true` por defecto cuando `resume=false` (compatibilidad con clientes viejos), evitando que se ignore el tama√±o seleccionado.
- MC-118 | done | P1 | Hardening product-enrichment (image URLs) + revisi√≥n manual visible en admin | Normalizaci√≥n de URLs de im√°genes antes de OpenAI (`//` y relativas), descarte de URLs inv√°lidas para evitar `Invalid image_url`, nuevo endpoint `GET /api/admin/product-enrichment/review-items` y mejora de `/admin/product-enrichment` con tabla operativa de revisi√≥n manual/baja confianza y acceso directo a producto.
- MC-117 | done | P1 | Reingenier√≠a enrichment v12.5 (se√±ales + prompts por grupo + consistencia) | Harvesting pre-LLM (nombre/descripcion original/metadata vendor), prompts especializados por grupo con routing determin√≠stico (sin segunda llamada), estrategia de im√°genes por categor√≠a, validador post-LLM con auto-fix + `confidence` local y `review_required`, preservaci√≥n de `original_description`, y bloqueo por defecto de re-enrichment IA en productos ya enriquecidos.
- MC-116 | done | P1 | Cat√°logo p√∫blico: ocultar no enriquecidos + fix im√°genes proxy | `/catalogo` (y aliases `/g/*`, `/buscar`) oculta productos sin `products.metadata.enrichment`; `next/image` evita optimizar `src=/api/image-proxy` (unoptimized) para no caer en 400 `INVALID_IMAGE_OPTIMIZE_REQUEST`; script de backfill de covers a Blob.
- MC-115 | done | P1 | Curaci√≥n humana (admin) + bulk edit de caracter√≠sticas | Nuevo m√≥dulo `/admin/product-curation` con filtros compartidos con `/catalogo`, scroll infinito, selecci√≥n multi-producto y bulk edit modal (`replace/add/remove/clear`) con auditor√≠a en `metadata.enrichment_human` sin tocar `metadata.enrichment`. Hardening 2026-02-16: universo por defecto alineado con `/catalogo` (`enrichedOnly=true` + `inStock=true`) en `products/facets/ids`.
- MC-127 | done | P1 | Curaci√≥n humana (admin): filtro por SEO tags (top 300) | Caja de filtros con SEO tags abundantes (hasta 300 principales) para acelerar la curaci√≥n de productos.
- MC-114 | done | P1 | Auth usuarios externos (Descope) + perfil + favoritos/listas + analytics base | Login social con Descope, perfil privado, tablas y endpoints de experiencia/favoritos/listas.
- MC-009 | done | P1 | Taxonom√≠a editable + publicaci√≥n (admin) | Nuevo panel `/admin/taxonomy` con draft‚Üípublish, tabla `taxonomy_snapshots`, endpoints admin, propagaci√≥n a prompt enrichment, curaci√≥n humana y labels de facets, editor de `style_profiles` + recompute.
- MC-113 | done | P1 | Home editorial + mega menu + rotaci√≥n 3 d√≠as | Home p√∫blico con mega menu por g√©nero, reglas category+subcategory y rotaci√≥n autom√°tica cada 3 d√≠as.
- MC-112 | done | P1 | Des-dockerizar repo | Eliminar Dockerfiles/compose y actualizar docs para ejecuci√≥n local con npm.
- MC-111 | done | P1 | Paleta 200 + matching estandarizado de combinaciones | `color_combinations.colorsJson` + paleta 200 en `color_combination_colors`; matching 200‚Üí60 con standard colors y rebuild de relaciones.
- MC-108 | done | P1 | Fix cola de scraping de marcas | Encolar solo marcas sin job completed y drenar cola existente desde UI.
- MC-109 | done | P1 | Onboarding de marca en modal | Crear marca inicia pipeline (enrich ‚Üí tech ‚Üí cat√°logo ‚Üí productos) con barra de progreso y endpoints onboarding.
- MC-110 | done | P1 | Refresh semanal de cat√°logo + monitor admin | Cron semanal con jitter, refresco completo, m√©tricas de cambios y panel `/admin/catalog-refresh`; VTEX discovery sin cap fijo (capping opcional por env); hardening: normalizaci√≥n LLM con fallback, runs de enrichment en `paused` (sin auto-ejecuci√≥n), concurrencia por marca configurable (`CATALOG_REFRESH_BRAND_CONCURRENCY`) y fix de parseo en `/api/admin/catalog-refresh/cron` para que par√°metros opcionales ausentes no degraden a `maxBrands=1`/`brandConcurrency=1`/`maxRuntimeMs=5000`.

## Done (2026-01)
- MC-107 | done | P1 | Enrichment: esquema estricto + repair/chunking Bedrock | 1 imagen por variante, repair pass y chunking por variantes; smoke test Bedrock; concurrencia 40 en envs prod.
- MC-106 | done | P1 | Estilos principal/secundario por styleTags | Tabla style_profiles + trigger + backfill; labels humanos en admin.
- MC-105 | done | P1 | Filtro por rol de color en combinaciones | `/api/admin/color-combinations/[id]/products` filtra por categorias permitidas segun rol (dominante/secundario/acento).
- MC-104 | done | P1 | Enrichment productos con Claude (Bedrock) | Product enrichment usa Bedrock (Claude Sonnet 4.5) v√≠a inference profile; OpenAI queda para el resto.
- MC-103 | done | P1 | Campos SEO en productos + enriquecimiento IA | Nuevas columnas seoTitle/seoDescription/seoTags[] y prompt de enrichment genera meta title/description + tags.
- MC-102 | done | P1 | Enriquecimiento productos: persistencia + progreso realtime + reset batches | URL state, conteos por status en UI y endpoint para limpiar batches activos.
- MC-100 | done | P1 | Filtro de categorias + orden por productos en /admin/brands | Multiselect `brands.category` y sort `productCount` asc/desc.
- MC-099 | done | P1 | Contador pendientes marcas: desglose y elegibilidad | `/api/admin/brands` expone pending breakdown (queued/no_jobs/failed/manualReview/cloudflare) y la UI lo muestra.
- MC-098 | done | P1 | Acelerar serving de im√°genes (proxy+cache) | Nuevo `/api/image-proxy` cachea en Blob/CDN y el admin lo usa en logos/grids con `next/image`.
- MC-097 | done | P1 | Persistencia de navegaci√≥n en admin (page/filter en URL) | `/admin/brands` y `/admin/products` conservan p√°gina/filtros tras reload/acciones y ajustan p√°gina si se sale de rango.
- MC-096 | done | P1 | Modal marcas: stats reales + preview + delete cascada | Modal usa stats reales desde variants, preview 10 productos con deep-link a `/admin/products?productId=...` y delete hard cascade.
- MC-095 | done | P1 | UI: ver marcas sin run agrupadas por tecnolog√≠a | Toggle en extractor + API soporta onlyNoRun/all y l√≠mite ampliado.
- MC-094 | done | P1 | Sitemap discovery tolerante a fallos | Robots/sitemaps con fetch error no bloquean el run; fallback a adapter.
- MC-093 | done | P1 | Sitemap completo sin corte temprano | No se corta en el primer sitemap de productos; l√≠mite configurable y sin cap fijo.
- MC-090 | done | P1 | Sitemap budget + precios Woo fallback | Prioriza robots y limita tiempo de discovery; precios Woo se completan con fallback HTML cuando API devuelve 0.
- MC-091 | done | P1 | Drain finaliza runs idle + control sitemap/queue | Drain marca run completed si no hay pendientes; /run respeta enqueueOnly y `CATALOG_FORCE_SITEMAP`.
- MC-092 | done | P1 | Reducir reintentos de cat√°logo | M√°ximo 1 reintento por producto y 1 reintento en cola.
- MC-089 | done | P1 | Concurrencia alta + progreso frecuente en extractor | Drenado m√°s r√°pido y polling ~2s en UI.
- MC-088 | done | P1 | Catalog extractor no pausa por errores de producto | Errores soft no cuentan para auto-pause; continua la corrida.
- MC-087 | done | P2 | Modal productos + carrusel en cards | Colores visibles con swatches, resumen de variantes y navegaci√≥n de fotos en listado.
- MC-086 | done | P2 | Progreso incremental en panel product-enrichment | Run no drena en la misma request; barra avanza v√≠a polling + cron.
- MC-085 | done | P2 | Style tags exactos 10 | Prompt y validaci√≥n ajustados a 10 tags exactos.
- MC-084 | done | P2 | Auto-refresh solo con runs processing | Panel enrichment refresca solo cuando hay run activo.
- MC-083 | done | P1 | Estabilidad product-enrichment (cron + auto-refresh) | Drain serverless y cron Vercel para product-enrichment; auto-refresh en panel.
- MC-082 | done | P1 | Normalizacion determinista v2 (reglas extendidas) | Reglas de categoria, material, patron, fit y color mejoradas para reducir LLM.
- MC-081 | done | P1 | Catalog extractor: normalizacion determinista + menos OpenAI | Shopify/Woo sin LLM, payload LLM recortado, retries/backoff en cola, auto-finish marcas sin fallos.
- MC-080 | done | P1 | Enriquecimiento IA de productos | Admin + cola para enriquecer categor√≠as/tags/colores/fit con GPT-5 mini.
- MC-073 | done | P1 | Drain serverless cat√°logo (Vercel cron) | Endpoint drain + cron cada minuto para procesar sin worker persistente.
- MC-072 | done | P1 | Redis + cola operativa en Vercel | REDIS_URL correcto en Vercel, guardas de cola y reanudacion sin timeouts.
- MC-071 | done | P1 | Blob robusto: sanitizar path + tolerar fallos | Evita error por # y no aborta por fallos parciales.
- MC-070 | done | P1 | Concurrencia cat√°logo v2 (cola + runs/items) | Tablas + BullMQ + worker + backfill.
- MC-069 | done | P1 | Robustez extractor: telemetr√≠a + pausa por errores | lastUrl/lastStage/errorSamples y pausa por errores consecutivos.
- MC-068 | done | P1 | Resume UI + barrido + GPT-5 mini en productos | Bot√≥n Resume en pausa/stop, sync cursor, modelo barato para PDP/normalizaci√≥n.
- MC-067 | done | P1 | Detener extractor conserva estado | Stop mantiene cursor/refs y permite reanudar sin reiniciar.
- MC-066 | done | P1 | Finalizar marca en catalog extractor | Bot√≥n y endpoint para sacar marcas de la cola y registrar `catalog_extract_finished`.
- MC-064 | done | P1 | Normalizar ImageObject en blob | Extrae contentUrl/thumbnail antes de upload.
- MC-065 | done | P1 | LLM PDP fallback + limpieza de marcas | Clasifica PDP con LLM, extrae RawProduct y elimina marcas no procesables.
- MC-063 | done | P1 | Blob: retry con referer/UA | Reduce fallos por hotlinking al subir im√°genes.
- MC-062 | done | P1 | Custom: evitar URLs no-producto desde sitemap | Excluye /portafolio y no usa URLs no-producto cuando no hay coincidencias.
- MC-061 | done | P1 | Unknown: sitemaps extra + inferencia r√°pida plataforma | Nuevos sitemaps (wp/products/store), inferencia sin LLM y pistas microdata.
- MC-060 | done | P1 | Custom: excluir listados por og:type/rutas | Negativos blog/collections + og:type website sin price meta.
- MC-059 | done | P1 | Custom: omitir listados y detectar producto por pistas | Ajusta heur√≠sticas /tienda y /shop; acepta product hints cuando no hay JSON-LD.
- MC-058 | done | P1 | Mejoras unknown: tech profiler + custom discovery | Tiendanube/Wix + parked/unreachable; patrones /product-page y /product-.
- MC-057 | done | P1 | Marcar manualReview cuando no hay productos | Bloquea runs sin productos y setea manualReview + metadata de revisi√≥n.
- MC-056 | done | P1 | Filtrar sitemap a mismo dominio | Evita URLs externas en VTEX y reduce raw vac√≠o.
- MC-055 | done | P1 | Fallback a API si sitemap no trae productos | Evita URLs no-producto en VTEX; usa discovery del adapter.
- MC-054 | done | P1 | Sitemap scan completo + fallbacks Woo/VTEX | Descubrimiento product-aware, gzip/index, l√≠mite de sitemaps y smoke test; Vercel pendiente (sin token).
- MC-053 | done | P1 | Fix VTEX linkText en sitemap + error m√°s claro | Deriva linkText desde URL y mejora mensaje cuando raw es vac√≠o.
- MC-052 | done | P1 | Errores visibles en catalog extractor | Muestra √∫ltimo error, bloqueos y errores recientes en panel.
- MC-051 | done | P1 | Catalog extractor por tecnologia con play/pause/stop | Seleccion por plataforma, auto‚Äëavance de marcas, sitemap-first y reanudacion por cursor.
- MC-050 | done | P1 | Fix Unicode tech profiler | Sanitiza Unicode y parseo JSON para evitar errores de escape al guardar metadata.
- MC-049 | done | P1 | Volver a modelo OpenAI gpt-5.2 | Default en scrapers/normalizer y env example/documentaci√≥n.
- MC-048 | done | P1 | Evidencia textual limpia en scraper de marcas | Limpieza de HTML‚Üítexto, prioriza l√≠neas relevantes y reduce ruido en evidencia OpenAI.
- MC-047 | done | P1 | Cambiar modelo OpenAI a gpt-5-mini | Reduce costos en scrapers (marcas, tech, cat√°logo).
- MC-046 | done | P1 | Reglas de moneda + reset cat√°logo | Parsing precios, currency en productos, truncate products/variants.
- MC-045 | done | P1 | Progreso extractor productos | Barra de progreso informativa + reanudaci√≥n por tandas + hardening OpenAI.
- MC-044 | done | P1 | Directorio de productos admin | Cards con detalle, filtros por marca, endpoints productos.
- MC-043 | done | P1 | Catalog extractor por tecnolog√≠a | Adaptadores Shopify/Woo/Magento/VTEX/Custom, normalizaci√≥n OpenAI, im√°genes a Blob, panel admin.
- MC-042 | done | P2 | Revisi√≥n manual de marcas | Check azul en cards + toggle en modal, persistido en DB.
- MC-041 | done | P1 | Tech profiler de marcas | Campo ecommercePlatform, perfilado Shopify/Woo/Magento/VTEX, panel /admin/brands/tech.
- MC-035 | done | P1 | Scraper de marcas (enriquecimiento OpenAI) | Panel /admin/brands con cola 1/5/10/25/50; endpoints admin + cron; OpenAI web search JSON mode + fallback HTML; diff de cambios en historial; actualizaci√≥n de tabla brands y metadata.
- MC-006 | done | P1 | Autenticaci√≥n y roles base | Login admin (email/password + cookie), ruta /admin sin /admin/login, seed admin en Neon, middleware s√≥lo en /api/normalize.
- MC-004 | done | P0 | Conexi√≥n OpenAI GPT-5.2 JSON mode | Helper con retries/validaci√≥n Zod, endpoint `/api/normalize`, middleware Bearer (ADMIN_TOKEN/NEXTAUTH_SECRET), carpeta `/admin` base; README documentado.
- MC-003 | done | P1 | Esquema Neon + migraciones | Prisma schema con brands/stores/products/variants/price&stock history/assets/events/taxonomy/announcements/users; pgvector habilitado; migraci√≥n `20260115125012_init_schema`.
- MC-002 | done | P1 | Docker compose local (retirado 2026-02) | Servicios web/scraper/worker, Postgres pgvector, Redis; healthchecks; puerto host 3080; `.env.example` alineado con Vercel; stack sube con `docker-compose up -d`.
- MC-001 | done | P1 | Estructura base repo y convenciones | Next app TS/Tailwind en apps/web, estructura servicios scraper/worker, .gitignore, .env.example, docker-compose base, README creado.
- MC-036 | done | P1 | Directorio de marcas admin | Grid 3x5, modal detalle, CRUD marcas, filtros/paginaci√≥n en /admin/brands; endpoints CRUD en /api/admin/brands.
- MC-037 | done | P1 | Resiliencia scraping admin | Re‚Äëencolar jobs atascados, auto‚Äëresume tras recarga, separaci√≥n de /admin/brands y /admin/brands/scrape con men√∫ lateral.
- MC-038 | done | P2 | Admin layout anclado | Sidebar anclado a la izquierda para maximizar el canvas de contenido.
- MC-039 | done | P2 | Mejoras cards marcas | Mostrar logo en card y URLs cliqueables en modal.
- MC-040 | done | P1 | Re‚Äëenriquecimiento por marca | M√©todo 2 (14 fuentes, 20k chars) desde card con progreso mini.

---
**Instrucci√≥n operativa**: al abordar cualquier historia de este backlog: (0) pedir requisitos previos (credenciales/API keys, definiciones faltantes), (1) levantar servicios locales necesarios (web/scraper/worker) y revisar logs, (2) push a la rama, (3) esperar y revisar build en Vercel hasta que finalice bien, (4) actualizar README con cambios relevantes, (5) marcar la historia como terminada en `USER_STORIES.md`, `BACKLOG.md` y en `STATUS.md`.
